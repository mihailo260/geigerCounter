<!DOCTYPE html>
<html>

<head>
    <title>Geiger Counter Pointer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        #canvasContainer {
            position: relative;

        }

        #myCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;


        }

        .health {

            width: 1000px;
            background-color: #ddd;
            border-radius: 10px;
            overflow: hidden;
            height: 100%;
            background-color: #4caf50;
            transition: all 0.03s;
        }
    </style>
</head>

<body>
    <div id="canvasContainer">
        <img src="iStock-1030235422.jpg" width="1000" height="1200" alt="">
        <canvas id="myCanvas" width="1000" height="1200"></canvas>
    </div>
    <div id="healthLevel" class="health">&nbsp;</div>
    <audio id="sound" src="radiation-sound-effect.mp3" preload="sound"></audio>
    <script>
        backgroundImage = new Image()
        backgroundImage.src = "iStock-1030235422.jpg"
        canvas = document.getElementById("myCanvas");
        ctx = canvas.getContext("2d");
        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height); // Draw the background image
        sound = document.getElementById("sound");

        radX = 150
        radY = 150
        radiusRad = [20,40,60,80,100,150,250]
        centerX = 500
        centerY = 500
        radius = 60
        circleCatched = false

        geigerX = 1000 / 2
        geigerY = 1200
        radiusGeiger = 250
        angle = -Math.PI

        function drawRadCircles(x, y, radious) {
            ctx.beginPath()
            ctx.arc(x, y, radious, 0, 2 * Math.PI);
            ctx.fillStyle = "rgba(0, 200, 0, 0.3)";
            ctx.fill();
            ctx.closePath();
        }
        function drawCircle(x, y) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, 2 * Math.PI);
            ctx.fillStyle = "blue";
            ctx.fill();
            ctx.closePath();

        }
        changeLine(angle)
        drawCircle(centerX, centerY)
        drawRAD()
        drawGeigerCounter()
        // touchstart,touchmove,touchend
        // mousedown,mousemove,mouseup
        canvas.addEventListener('mousedown', function (event) {
            rect = canvas.getBoundingClientRect()
            // event = event.touches[0]
            X = event.clientX - rect.left
            Y = event.clientY - rect.top
            if (Math.sqrt((X - centerX) ** 2 + (Y - centerY) ** 2) <= radius) {
                circleCatched = true
            }
        })
        canvas.addEventListener("mousemove", function (event) {
            if (circleCatched) {
                rect = canvas.getBoundingClientRect();
                // event = event.touches[0]
                X = event.clientX - rect.left
                Y = event.clientY - rect.top

                checkCollision(X, Y, radiusRad)
                changeLine(angle)
                drawCircle(X, Y)
                drawRAD()
                drawGeigerCounter()
            }
        })
        canvas.addEventListener("mouseup", function () {
            circleCatched = false;
            angle = -Math.PI
            sound.pause()
            drawCircle(centerX, centerY)
            health = 100
            updateHealthBar()
            drawGeigerCounter()
            changeLine(angle)
            drawRAD()
        });
        function drawRAD() {
            for (let i = 0; i < radiusRad.length; i++) {
                drawRadCircles(radX, radY, radiusRad[i])
            }
        }
        function drawGeigerCounter() {
            ctx.beginPath();
            ctx.arc(geigerX, geigerY, radiusGeiger, Math.PI, 0);
            ctx.lineWidth = 8;
            ctx.strokeStyle = "black";
            ctx.fillStyle = "white"
            ctx.stroke();

            changeLine(angle);
        }
        function changeLine(angle) {


            x = geigerX + radiusGeiger * Math.cos(angle);
            y = geigerY + radiusGeiger * Math.sin(angle);

            ctx.beginPath();
            ctx.moveTo(x,y);
            ctx.lineTo(geigerX, geigerY);
            ctx.strokeStyle = "red";
            ctx.lineWidth = 10;
            ctx.stroke();
        }
        function checkCollision(x, y) {

            for (i =  0; i < radiusRad.length; i++) {    
                console.log(angle)
                if (Math.sqrt((x - radX) ** 2 + (y - radY) ** 2) <= radiusRad[i]) {
                    sound.play()
                    angle = angle - (-Math.PI)/(radiusRad.length * i+1)
                    decreaseHealth(0.03)

                } else {
                    sound.pause()

                }

            }

        }
        health = 100
        healthLevel = document.getElementById("healthLevel");
        function updateHealthBar() {
            healthLevel.style.width = health + "%";
        }
        function decreaseHealth(amount) {
            health -= amount;
            if (health < 0) {
                health = 0;
            }
            updateHealthBar();
        }

    </script>
</body>

</html>